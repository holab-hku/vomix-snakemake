$schema: "http://json-schema.org/draft-04/schema#"
description: Configuration schema
properties:
  module:
    type: string
    description: "The name of the module of vOMIX-MEGA that you would like to employ."
    default: "end-to-end"
    enum: ["preprocess", "assembly", "viral-identify", "viral-refilter", "viral-benchmark", "viral-taxonomy", "viral-host", "viral-community", "viral-annotate", "prok-binning", "prok-community", "prok-annotate", "end-to-end", "checkv-pyhmmer", "cluster-fast", "setup-database", "symlink"]

  workdir:
    type: string
    description: "The workding directory to the snakemake back-end workflow. Do NOT change this parameter unless you are an advanced user or are debugging."
    default: "."

  basedir:
    type: string
    description: "The base directory of the Snakefile to the snakemake back-end workflow. Do NOT change this parameter unless you are an advanced user or are debugging."
    default: ""

  outdir:
    type: string
    description: "The path to the director which you would like to deposit the vOMIX-MEGA structured outputs. If a new directory is given it will be created (nested supported). If an existing directory, the results will be over-written or deposited onto the same project. "
    default: "results/"

  datadir:
    type: string
    description: "The path to the raw fastq files deposited either for checking whether files are pre-downloaded, or to download new data onto. "
    default: "fastq/"

  samplelist:
    type: string
    description: "The path to the sample_list.csv file used to configure inputes and file paths. Please visit our Wiki page https://github.com/holab-hku/vOMIX-MEGA/wiki to know more. "
    default: ""

  fasta:
    type: string
    description: "The path to a single fasta file as input in modules where a single fasta file is permitted as a valid input. File path must end with .fasta, .fa, or .fna."
    default: ""

  fastadir:
    type: string
    description: "The path to a directory containing fasta file as input in modules where a fasta directory is permitted as a valid input. Automatically all files ending with .fasta, .fa, and .fna will be selected. "
    default: ""

  sample-name:
    type: string
    description: "If using the --fasta or config['fasta'] input, you can provide a sample name to use for output naming."
    default: ""

  assembly-ids:
    type: string
    description: "If using the --fasta-dir or config['fastadir'] input, you can provide a list of sample names equal to the length of your input files in list format ['sampleA', 'SampleB', 'sampleC',â€¦]. WARNING that this feature has not been comprehensively tested yet, so proceed with caution."
    default: ""

  latest-run:
    type: string
    description: "An internal parameter for assigning the value the time and date of current run for logging instances of running vOMIX-MEGA in the .vomix subdirectory. Please visit our website for documentation https://github.com/holab-hku/vOMIX-MEGA/wiki. "
    default: ""

  splits:
    type: integer
    description: "When applicalbe, split the data into N groups in order to process them in parallel and reduce memory burden e.g. when running geNomad using the --splits function. By default N=0, meaning no splits."
    default: 0

  keep-intermediates:
    type: boolean
    description: "Flag to keep all large intermediate files in the processing steps e.g. the fastp-cleaned raw fastq files before host-decontamination (if setting --decontam-host or config['host-decontam']=True.  "
    default: False

  setup-database:
    type: boolean
    description: "If running a module other than 'setup-database', this flag determines whether you would like to setup new databases. If databases have already been configured and not changed as determined by snakemake, this will result in no re-installations. To force this, use the --forcerun or -F flag."
    default: True

  max-cores:
    type: integer
    description: "The maximum number of cores to split between parallel snakemake tasks. Not to be confused with -j or -n. This feature is still in development. "
    default: 4

  NCBI-email:
    type: string
    description: "The email to use for fetching data from the NCBI database for downloading and verification. "
    default: "vomixtest@gmail.com"

  NCBI-API-key:
    type: string
    description: "The NCBI-API key  for fetching larger amounts of data. To learn more visit https://ncbiinsights.ncbi.nlm.nih.gov/2017/11/02/new-api-keys-for-the-e-utilities . "
    default: ""

  hostile-index-db:
    type: string
    description: "Path to the directory where Hostile database is installed or will be downloaded. By default will be rooted in the Snakemake base directory under workflow/databases."
    default: "database/hostile"

  PhaBox2-db:
    type: string
    description: "Path to the directory where PhaBox2 database is installed or will be downloaded. By default will be rooted in the Snakemake base directory under workflow/databases."
    default: "database/phabox_db_v2"

  genomad-db:
    type: string
    description: "Path to the directory where geNomad database is installed or will be downloaded. By default will be rooted in the Snakemake base directory under workflow/databases."
    default: "database/genomad"

  virsorter2-db:
    type: string
    description: "Path to the directory where VirSorter2 database is installed or will be downloaded. By default will be rooted in the Snakemake base directory under workflow/databases."
    default: "database/virsorter2"

  vibrant-db:
    type: string
    description: "Path to the directory where VIBRANT database is installed or will be downloaded. By default will be rooted in the Snakemake base directory under workflow/databases."
    default: "database/vibrant"

  checkv-db:
    type: string
    description: "Path to the directory where CheckV database is installed or will be downloaded. By default will be rooted in the Snakemake base directory under workflow/databases."
    default: "database/checkv"

  iphop-db:
    type: string
    description: "Path to the directory where iPHoP database is installed or will be downloaded. By default will be rooted in the Snakemake base directory under workflow/databases."
    default: "database/iphop"

  iphop-db-version:
    type: string
    description: "The version of the iPHoP database to use. Make sure base name is compatible with version https://bitbucket.org/srouxjgi/iphop/src/main/#markdown-header-host-databases-and-versions . "
    default: "iPHoP_db_Aug23_rw"

  iphop-db-basename:
    type: string
    description: "The base name for the iPHoP database. Make sure base name is compatible with version https://bitbucket.org/srouxjgi/iphop/src/main/#markdown-header-host-databases-and-versions . "
    default: "Aug_2023_pub_rw"

  eggNOG-db:
    type: string
    description: "Path to the directory where eggNOG database is installed or will be downloaded. By default will be rooted in the Snakemake base directory under workflow/databases."
    default: "database/eggNOGv2"

  eggNOG-db-params:
    type: string
    description: "Parameters for downloading the eggNOG database. Visit https://github.com/eggnogdb/eggnog-mapper for more information."
    default: ""

  humann-db:
    type: string
    description: "Path to the directory where HUMAnN3 database is installed or will be downloaded. By default will be rooted in the Snakemake base directory under workflow/databases."
    default: "database/humann"

  checkm2-db:
    type: string
    description: "Path to the directory where CheckM2 database is installed or will be downloaded. By default will be rooted in the Snakemake base directory under workflow/databases."
    default: "database/checkm2"

  GTDBTk-db:
    type: string
    description: "Path to the directory where GTDBTk database is installed or will be downloaded. By default will be rooted in the Snakemake base directory under workflow/databases."
    default: "database/GTDB-Tk"

  GTDBTk-db-version:
    type: string
    description: "The version of the GTDBTk database to use. Make sure that the database is compatible with the version of GTDB-Tk used https://ecogenomics.github.io/GTDBTk/installing/index.html#gtdb-tk-reference-data. "
    default: "220"

  dwnld-params:
    type: string
    description: "Parameters for downloading raw fastq files from the NCBI database using entrez-fetch."
    default: ""

  dwnld-only:
    type: boolean
    description: "A flag to indicate whether only remote SRA files should be downloaded from the NCBI database without running downstream pre-processing."
    default: False

  pigz-params:
    type: string
    description: "Parameters for pigz zipping of the fastq files downloaded from the SRA."
    default: ""

  fastp-params:
    type: string
    description: "Additional parameters to pass  to fastp preprocessing ."
    default: ""

  hostile-params:
    type: string
    description: "Additional parameters to pass  to Hostile decontamination."
    default: ""

  hostile-index-name:
    type: string
    description: "The name of the pre-made Hostile indices. Please visit https://github.com/bede/hostile for more information and make sure it exists in the current version of Hostile installed in this vOMIX-MEGA module."
    default: "human-t2t-hla"

  decontam-host:
    type: boolean
    description: "A flag to indicate whether host decontamination should be done after cleaning files with fastp. The host index can be passed via the --hostile-index-name command or config['hostile-index-name']"
    default: True

  hostile-aligner:
    type: string
    description: "The short read aligner to use for host decontamination, either 'bowtie2' or 'minimap2'. WARNING that Hostile does not recommend using minimap2 for short reads as of now. "
    default: "bowtie2"

  hostile-aligner-params:
    type: string
    description: "Additional parameters to pass  to Hostile aligner."
    default: ""

  assembler:
    type: string
    description: "The underlying tool to use for the assembly module. 'spades' is not yet available and is being developed. "
    default: "megahit"
    enum: ["megahit", "spades"]

  megahit-min-len:
    type: integer
    description: "The minimum length for the MEGAHIT assembly contig cutoff. "
    default: 300

  megahit-params:
    type: string
    description: "Additional parameters to pass  to MEGAHIT."
    default: "--prune-level 3"

  spades-params:
    type: string
    description: "Additional parameters to pass  to SPAdes."
    default: "--meta"

  spades-memory:
    type: integer
    description: "The maximum memory allocated to SPAdes for assembly. "
    default: 250

  contig-min-len:
    type: integer
    description: "The minimum length of contig to analyze for viral-identify module. All contigs shorter than this length will be removed from analysis. "
    default: 0

  genomad-min-len:
    type: integer
    description: "The minimum length of contig to analyze by geNomad. All contigs shorter than this length will be removed from analysis. "
    default: 1000

  genomad-params:
    type: string
    description: "Additional parameters to pass  to geNomad for viral-identify."
    default: "--enable-score-calibration --relaxed"

  genomad-cutoff:
    type: number
    description: "The minimum cutoff value for geNomad to identify a contig as viral. "
    default: 0.7

  genomad-cutoff-s:
    type: number
    description: "The minimum cutoff value for geNomad to identify a contig as viral in secondary filter. If set to 0, secondary filter will be skipped (recommended)"
    default: 0

  checkv-original:
    type: boolean
    description: "Flag to use the original CheckV in place of memory-efficient and faster CheckV-PyHMMER (not recommended)."
    default: False

  checkv-params:
    type: string
    description: "Additional parameters to pass  to CheckV."
    default: ""

  clustering-fast:
    type: boolean
    description: "Flag to use a faster, MEGABlast-based clustering approach for vOTU generation."
    default: True

  cdhit-params:
    type: string
    description: "Additional parameters to pass  to CD-HIT."
    default: "-c 0.95 -aS 0.85 -d 400 -M 0 -n 5"

  vOTU-ani:
    type: number
    description: "The average nucleotide identity clustering threshold for --clustering-fast. Set by default to 95% according to the MIUViG guidelines, readi more at https://doi.org/10.1038/nbt.4306. "
    default: 95
    minimum: 0
    maximum: 100

  vOTU-targetcov:
    type: number
    description: "The target coverage clustering threshold for --clustering-fast. Set by default to 85% according to the MIUViG guidelines, readi more at https://doi.org/10.1038/nbt.4306. "
    default: 85
    minimum: 0
    maximum: 100

  vOTU-querycov:
    type: number
    description: "The target query clustering threshold for --clustering-fast. "
    default: 0
    minimum: 0
    maximum: 100

  dvf-min-len:
    type: number
    description: "The minimum length of contig to analyze by DeepVirFinder. All contigs shorter than this length will be removed from analysis. "
    default: 1500
    minimum: 0

  phamer-min-len:
    type: number
    description: "The minimum length of contig to analyze by PhaMer. All contigs shorter than this length will be removed from analysis. "
    default: 2000
    minimum: 0

  dvf-params:
    type: string
    description: "Additional parameters to pass  to DeepVirFinder."
    default: ""

  phamer-params:
    type: string
    description: "Additional parameters to pass  to PhaMer."
    default: ""

  virsorter2-params:
    type: string
    description: "Additional parameters to pass  to VirSorter2."
    default: ""

  vf-params:
    type: string
    description: "Additional parameters to pass  to VirFinder."
    default: ""

  vibrant-params:
    type: string
    description: "Additional parameters to pass  to VIBRANT."
    default: ""

  seeker-params:
    type: string
    description: "Additional parameters to pass  to Seekr."
    default: ""

  ppr-params:
    type: string
    description: "Additional parameters to pass  to PPR-META."
    default: ""

  dvf-cutoff:
    type: number
    description: "The minimum cutoff value for DeepVirFinder  to identify a contig as viral. "
    default: 0.7
    minimum: 0
    maximum: 1

  dvf-pval:
    type: number
    description: "The maximum cutoff value for DeepVirFinder p-value to identify a contig as viral. "
    default: 0.05

  phamer-pred:
    type: string
    description: "The category for which PhaMer will identify a contig  as viral. "
    default: "phage"
    enum: ["phage", "non-phage"]

  phamer-cutoff:
    type: number
    description: "The minimum cutoff value for PhaMer prediction score to identify a contig as viral. "
    default: 0

  vf-cutoff:
    type: number
    description: "The minimum cutoff value for Virfinder score to identify a contig as viral. "
    default: 0

  virsorter2-cutoff:
    type: number
    description: "The minimum cutoff value for VirSorter2 to identify a contig as viral. "
    default: 0

  seeker-cutoff:
    type: number
    description: "The minimum cutoff value for Seeker to identify a contig as viral. "
    default: 0

  ppr-cutoff:
    type: number
    description: "The minimum cutoff value for PPR-META to identify a contig as viral. "
    default: 0

  vibrant-cutoff:
    type: number
    description: "The minimum cutoff value for VIBRANT to identify a contig as viral. "
    default: 0

  phagcn-min-len:
    type: number
    description: "The minimum length of contig to analyze by geNomad. All contigs shorter than this length will be removed from analysis. "
    default: 1000
    minimum: 0

  phagcn-params:
    type: string
    description: "Additional parameters to pass  to PhaGCN."
    default: ""

  genomad-params-tax:
    type: string
    description: "Additional parameters to pass  to geNomad for the viral-taxonomy module."
    default: "--enable-score-calibration --relaxed"

  coverm-params:
    type: string
    description: "Additional parameters to pass  to CoverM."
    default: "--mapper minimap2-sr --min-read-percent-identity 95 --min-read-aligned-percent 75 --trim-min 10 --trim-max 90"

  coverm-methods:
    type: string
    description: "The output methods of CoverM.DO NOT CHANGE this value, only used for debugging pruposes. "
    default: "tpm rpkm"

  iphop-host:
    type: boolean
    description: "Flag to indicate whether iPHoP host prediction should be carried out in place of CHERRY. Warning that iPHoP's database is extremely large and the memory usage is high. We hence recommend CHERRY. "
    default: False

  iphop-cutoff:
    type: number
    description: "The minimum cutoff value for iPHoP to consider a viral sequence as to belonging to a certain host. "
    default: 90
    minimum: 0
    maximum: 100

  iphop-params:
    type: string
    description: "Additional parameters to pass  to iPHoP."
    default: ""

  CHERRY-params:
    type: string
    description: "Additional parameters to pass  to CHERRY."
    default: ""

  PhaTYP-params:
    type: string
    description: "Additional parameters to pass  to PhaTYP."
    default: ""

  eggNOG-params:
    type: string
    description: "Additional parameters to pass  to eggNOG mapper."
    default: "-m diamond --hmm_evalue 0.001 --hmm_score 60 --query-cover 20 --subject-cover 20 --tax_scope auto --target_orthologs all --go_evidence non-electronic --report_orthologs"

  PhaVIP-params:
    type: string
    description: "Additional parameters to pass  to PhaVIP."
    default: ""

  mpa-params:
    type: string
    description: "Additional parameters to pass  to MPA MetaPhlAn."
    default: "--ignore_eukaryotes"

  mpa-indexv:
    type: string
    description: "Index version to use for MetaPhlAn. If not already present, it will be downloaded."
    default: "mpa_vOct22_CHOCOPhlAnSGB_202212"

  binning-consensus:
    type: boolean
    description: "Flag to indicate whether a consensus binning approach using MetaBAT2, MaxBin2, and CONCOT should be performed. Followed by consesnsus pooling using DASToo. Otheriwse, a GPU-based VAMB approach will be taken."
    default: False

  strobealign-params:
    type: string
    description: "Additional parameters to pass  to strobe align."
    default: ""

  MetaBAT2-params:
    type: string
    description: "Additional parameters to pass  to MetaBAT2."
    default: "-m 1500"

  MaxBin2-params:
    type: string
    description: "Additional parameters to pass  to MaxBin2."
    default: "-min_contig_length 1500 -max_iteration 50 -prob_threshold 0.9"

  CONCOCT-params:
    type: string
    description: "Additional parameters to pass  to CONCOCT."
    default: ""

  jgi-summarize-params:
    type: string
    description: "Additional parameters to pass  to jgi-summraize command."
    default: "--percentIdentity 97"

  DASTool-params:
    type: string
    description: "Additional parameters to pass  to DASTool."
    default: ""

  checkm2-params:
    type: string
    description: "Additional parameters to pass  to CheckM2."
    default: ""

  galah-params:
    type: string
    description: "Additional parameters to pass  to galah."
    default: "--ani 95 --min-aligned-fraction 15 --fragment-length 3000"

  GTDBTk-identify-params:
    type: string
    description: "Additional parameters to pass  to GTDBTk identify command."
    default: ""

  GTDBTk-align-params:
    type: string
    description: "Additional parameters to pass  to GTDBTk align command."
    default: ""

  GTDBTk-classify-params:
    type: string
    description: "Additional parameters to pass  to GTDBTk classify command."
    default: ""

  VAMB-params:
    type: string
    description: "Additional parameters to pass  to VAMB."
    default: "-m 100"

  humann-params:
    type: string
    description: "Additional parameters to pass  to HUMAnN."
    default: ""

required:
  - module
  - workdir
  - basedir
  - outdir
  - datadir
  - samplelist
  - fasta
  - fastadir
  - sample-name
  - assembly-ids
  - latest-run
  - splits
  - keep-intermediates
  - setup-database
  - max-cores
  - NCBI-email
  - NCBI-API-key
  - hostile-index-db
  - PhaBox2-db
  - genomad-db
  - virsorter2-db
  - vibrant-db
  - checkv-db
  - iphop-db
  - iphop-db-version
  - iphop-db-basename
  - eggNOG-db
  - eggNOG-db-params
  - humann-db
  - checkm2-db
  - GTDBTk-db
  - GTDBTk-db-version
  - dwnld-params
  - dwnld-only
  - pigz-params
  - fastp-params
  - hostile-params
  - hostile-index-name
  - decontam-host
  - hostile-aligner
  - hostile-aligner-params
  - assembler
  - megahit-min-len
  - megahit-params
  - spades-params
  - spades-memory
  - contig-min-len
  - genomad-min-len
  - genomad-params
  - genomad-cutoff
  - genomad-cutoff-s
  - checkv-original
  - checkv-params
  - clustering-fast
  - cdhit-params
  - vOTU-ani
  - vOTU-targetcov
  - vOTU-querycov
  - dvf-min-len
  - phamer-min-len
  - dvf-params
  - phamer-params
  - virsorter2-params
  - vf-params
  - vibrant-params
  - seeker-params
  - ppr-params
  - dvf-cutoff
  - dvf-pval
  - phamer-pred
  - phamer-cutoff
  - vf-cutoff
  - virsorter2-cutoff
  - seeker-cutoff
  - ppr-cutoff
  - vibrant-cutoff
  - phagcn-min-len
  - phagcn-params
  - genomad-params-tax
  - coverm-params
  - coverm-methods
  - iphop-host
  - iphop-cutoff
  - iphop-params
  - CHERRY-params
  - PhaTYP-params
  - eggNOG-params
  - PhaVIP-params
  - mpa-params
  - mpa-indexv
  - binning-consensus
  - strobealign-params
  - MetaBAT2-params
  - MaxBin2-params
  - CONCOCT-params
  - jgi-summarize-params
  - DASTool-params
  - checkm2-params
  - galah-params
  - GTDBTk-identify-params
  - GTDBTk-align-params
  - GTDBTk-classify-params
  - VAMB-params
  - humann-params
